<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../../../../../img/favicon.ico">
    <title>1 テンソルと演算 &mdash; Machine Learning</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../../../.." class="site-name"> Machine Learning</a>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../../../..">機械学習自習室</a></li>
                    <li class="toctree-l1"><button class="section nav-item">TensorFlow</button>
<ul class="subnav">
    <li class="toctree-l2 current"><button class="section nav-item">チュートリアル</button>
<ul class="subnav">
    <li class="toctree-l3"><button class="section nav-item hide">初級</button>
<ul class="subnav hide">
    <li class="toctree-l4"><button class="section nav-item hide">KerasによるMLの基本</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/基本的な画像分類/">1 基本的な画像の分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/TF.Hubによるテキスト分類/">2 TF.Hubによるテキスト分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/映画レビューのテキスト分類/">3 映画レビューのテキスト分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/回帰：燃費を予測する/">4 回帰：燃費を予測する</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/過学習と学習不足/">5 過学習と学習不足</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/モデルの保存と復元/">6 モデルの保存と復元</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">データの読み込みと前処理</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/CSV/">1 CSV</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/NumPy/">2 NumPy</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/pandas.DataFrame/">3 pandas.DataFrame</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/画像/">4 画像</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/テキスト/">5 テキスト</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l3 current"><button class="section nav-item">詳細</button>
<ul class="subnav">
    <li class="toctree-l4 current"><button class="section nav-item">カスタマイズ</button>
<ul class="subnav">
    <li class="toctree-l5 current"><a class="nav-item current" href="./">1 テンソルと演算</a>
<ul class="subnav">
<li class="toctree-l6"><a class="nav-item toc" href="#11">1.1 テンソル</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#12-gpu">1.2 GPU による高速化</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#13">1.3 データセット</a></li>
</ul></li>
    <li class="toctree-l5"><a class="nav-item" href="../カスタムレイヤー/">2 カスタムレイヤー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../自動微分と勾配テープ/">3 自動微分と勾配テープ</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../カスタム訓練：基本/">4 カスタム訓練：基本</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../カスタム訓練：ウォークスルー/">5 カスタム訓練：ウォークスルー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../tf.functionで性能アップ/">6 tf.functionで性能アップ</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">画像</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../画像/畳み込みニューラルネットワーク/">1 畳み込みニューラルネットワーク</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../画像/画像分類/">2 画像分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../画像/TF.Hubによる転移学習/">3 TF.Hubによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../画像/学習済CNNによる転移学習/">4 学習済CNNによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../画像/画像セグメンテーション/">5 画像セグメンテーション</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../画像/TF.Hubによるオブジェクト検出/">6 TF.Hubによるオブジェクト検出</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">テキスト</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../テキスト/単語の埋め込み/">7 単語の埋め込み</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../テキスト/RNNを使ったテキスト分類/">8 RNNを使ったテキスト分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../テキスト/RNNを使ったテキスト生成/">9 RNNを使ったテキスト生成</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../テキスト/アテンションを用いたニューラル機械翻訳/">10 アテンションを用いたニューラル機械翻訳</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/machine-learning/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../../../初級/データの読み込みと前処理/テキスト/">&laquo; Previous</a></div>
    <div class="next"><a href="../カスタムレイヤー/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../../../.." class="site-name"> Machine Learning</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>TensorFlow &raquo; </li><li>チュートリアル &raquo; </li><li>詳細 &raquo; </li><li>カスタマイズ</li>
</ul>
</nav>
                <div id="content">
<h1 id="1"><span class="pheasant-header"><span class="header"><span class="number">1</span> <span class="title">テンソルと演算</span><span class="link"><a href="https://www.tensorflow.org/tutorials/customization/basics" target="_blank" title="https://www.tensorflow.org/tutorials/customization/basics"></a></span></span></span></h1>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import tempfile
import time

import numpy as np
import tensorflow as tf</code></pre></div>
<div class="report"><p><span class="count">[1]</span>
<span class="start">2019-11-10 09:54:43</span> (<span class="time">1.90s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min0s</span>)</span></p></div></div></div></div>

<h2 id="11"><span class="pheasant-header"><span class="header"><span class="number">1.1</span> <span class="title">テンソル</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">print(tf.add(1, 2))
print(tf.add([1, 2], [3, 4]))
print(tf.square(5))
print(tf.reduce_sum([1, 2, 3]))</code></pre></div>
<div class="report"><p><span class="count">[2]</span>
<span class="start">2019-11-10 09:54:45</span> (<span class="time">1.15s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">tf.Tensor(3, shape=(), dtype=int32)
tf.Tensor([4 6], shape=(2,), dtype=int32)
tf.Tensor(25, shape=(), dtype=int32)
tf.Tensor(6, shape=(), dtype=int32)</code></pre></div></div></div></div>

<p>Operator overloading is also supported</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">print(tf.square(2) + tf.square(3))</code></pre></div>
<div class="report"><p><span class="count">[3]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">15.6ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">tf.Tensor(13, shape=(), dtype=int32)</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">x = tf.matmul([[1]], [[2, 3]])
print(x)
print(x.shape)
print(x.dtype)</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">15.6ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">tf.Tensor([[2 3]], shape=(1, 2), dtype=int32)
(1, 2)
&lt;dtype: &#39;int32&#39;&gt;</code></pre></div></div></div></div>

<h3 id="111-numpy"><span class="pheasant-header"><span class="header"><span class="number">1.1.1</span> <span class="title">NumPy互換性</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">ndarray = np.ones([3, 3])

print(&#34;TensorFlow演算によりnumpy配列は自動的にテンソルに変換される&#34;)
tensor = tf.multiply(ndarray, 42)
print(tensor)

print(&#34;またNumPy演算によりテンソルは自動的にnumpy配列に変換される&#34;)
print(np.add(tensor, 1))

print(&#34;.numpy()メソッドによりテンソルは明示的にnumpy配列に変換される&#34;)
print(tensor.numpy())</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">31.4ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">TensorFlow演算によりnumpy配列は自動的にテンソルに変換される
tf.Tensor(
[[42. 42. 42.]
 [42. 42. 42.]
 [42. 42. 42.]], shape=(3, 3), dtype=float64)
またNumPy演算によりテンソルは自動的にnumpy配列に変換される
[[43. 43. 43.]
 [43. 43. 43.]
 [43. 43. 43.]]
.numpy()メソッドによりテンソルは明示的にnumpy配列に変換される
[[42. 42. 42.]
 [42. 42. 42.]
 [42. 42. 42.]]</code></pre></div></div></div></div>

<h2 id="12-gpu"><span class="pheasant-header"><span class="header"><span class="number">1.2</span> <span class="title">GPU による高速化</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">x = tf.random.uniform([3, 3])

print(&#34;利用できるGPUはあるか: &#34;)
print(tf.config.experimental.list_physical_devices(&#34;GPU&#34;))

print(&#34;テンソルはGPU #0にあるか:  &#34;)
print(x.device.endswith(&#34;GPU:0&#34;))</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">15.7ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">利用できるGPUはあるか: 
[PhysicalDevice(name=&#39;/physical_device:GPU:0&#39;, device_type=&#39;GPU&#39;)]
テンソルはGPU #0にあるか:  
True</code></pre></div></div></div></div>

<h3 id="121"><span class="pheasant-header"><span class="header"><span class="number">1.2.1</span> <span class="title">明示的デバイス配置</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">def time_matmul(x):
    start = time.time()
    for loop in range(10):
        tf.matmul(x, x)
    result = time.time() - start

    print(&#34;10 loops: {:0.2f}ms&#34;.format(1000 * result))

# CPUでの実行を強制
print(&#34;On CPU:&#34;)
with tf.device(&#34;CPU:0&#34;):
    x = tf.random.uniform([1000, 1000])
    assert x.device.endswith(&#34;CPU:0&#34;)
    time_matmul(x)
# GPU #0があればその上での実行を強制
if tf.config.experimental.list_physical_devices(&#34;GPU&#34;):
    print(&#34;On GPU:&#34;)
    with tf.device(&#34;GPU:0&#34;):  # 2番めのGPUなら GPU:1, 3番目なら GPU:2 など
        x = tf.random.uniform([1000, 1000])
        assert x.device.endswith(&#34;GPU:0&#34;)
        time_matmul(x)</code></pre></div>
<div class="report"><p><span class="count">[7]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">345ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">On CPU:
10 loops: 93.71ms
On GPU:
10 loops: 235.63ms</code></pre></div></div></div></div>

<h2 id="13"><span class="pheasant-header"><span class="header"><span class="number">1.3</span> <span class="title">データセット</span></span></span></h2>
<h3 id="131-dataset"><span class="pheasant-header"><span class="header"><span class="number">1.3.1</span> <span class="title">ソースDatasetの作成</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">ds_tensors = tf.data.Dataset.from_tensor_slices([1, 2, 3, 4, 5, 6])

# CSVファイルを作成
_, filename = tempfile.mkstemp()

with open(filename, &#34;w&#34;) as f:
    f.write(&#34;Line 1\nLine 2\nLine 3\n&#34;)
ds_file = tf.data.TextLineDataset(filename)</code></pre></div>
<div class="report"><p><span class="count">[8]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">40.9ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div></div></div>

<h3 id="132"><span class="pheasant-header"><span class="header"><span class="number">1.3.2</span> <span class="title">変換の適用</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">ds_tensors = ds_tensors.map(tf.square).shuffle(2).batch(2)
ds_file = ds_file.batch(2)</code></pre></div>
<div class="report"><p><span class="count">[9]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">31.3ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div></div></div>

<h3 id="133"><span class="pheasant-header"><span class="header"><span class="number">1.3.3</span> <span class="title">イテレート</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">print(&#34;ds_tensors の要素:&#34;)
for x in ds_tensors:
    print(x)
print(&#34;\nds_file の要素:&#34;)
for x in ds_file:
    print(x)</code></pre></div>
<div class="report"><p><span class="count">[10]</span>
<span class="start">2019-11-10 09:54:46</span> (<span class="time">46.9ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min2s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">ds_tensors の要素:
tf.Tensor([4 1], shape=(2,), dtype=int32)
tf.Tensor([16 25], shape=(2,), dtype=int32)
tf.Tensor([ 9 36], shape=(2,), dtype=int32)

ds_file の要素:
tf.Tensor([b&#39;Line 1&#39; b&#39;Line 2&#39;], shape=(2,), dtype=string)
tf.Tensor([b&#39;Line 3&#39;], shape=(1,), dtype=string)</code></pre></div></div></div></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../../../初級/データの読み込みと前処理/テキスト/" title="5 テキスト"><span>Previous</span></a></div>
        <div class="next"><a href="../カスタムレイヤー/" title="2 カスタムレイヤー"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>
        var base_url = '.';
    </script>
    <script src="../../../../../js/theme.js"></script>
    <script src="../../../../../js/pheasant.js"></script>
</body>

</html>