<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../../../../../img/favicon.ico">
    <title>1 畳み込みニューラルネットワーク &mdash; Machine Learning</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../../../.." class="site-name"> Machine Learning</a>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../../../..">機械学習自習室</a></li>
                    <li class="toctree-l1"><button class="section nav-item">TensorFlow</button>
<ul class="subnav">
    <li class="toctree-l2 current"><button class="section nav-item">チュートリアル</button>
<ul class="subnav">
    <li class="toctree-l3"><button class="section nav-item hide">初級</button>
<ul class="subnav hide">
    <li class="toctree-l4"><button class="section nav-item hide">KerasによるMLの基本</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/基本的な画像分類/">1 基本的な画像の分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/TF.Hubによるテキスト分類/">2 TF.Hubによるテキスト分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/映画レビューのテキスト分類/">3 映画レビューのテキスト分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/回帰：燃費を予測する/">4 回帰：燃費を予測する</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/過学習と学習不足/">5 過学習と学習不足</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/KerasによるMLの基本/モデルの保存と復元/">6 モデルの保存と復元</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">データの読み込みと前処理</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/CSV/">1 CSV</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/NumPy/">2 NumPy</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/pandas.DataFrame/">3 pandas.DataFrame</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/画像/">4 画像</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../初級/データの読み込みと前処理/テキスト/">5 テキスト</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l3 current"><button class="section nav-item">詳細</button>
<ul class="subnav">
    <li class="toctree-l4"><button class="section nav-item hide">カスタマイズ</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/テンソルと演算/">1 テンソルと演算</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/カスタムレイヤー/">2 カスタムレイヤー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/自動微分と勾配テープ/">3 自動微分と勾配テープ</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/カスタム訓練：基本/">4 カスタム訓練：基本</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/カスタム訓練：ウォークスルー/">5 カスタム訓練：ウォークスルー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../カスタマイズ/tf.functionで性能アップ/">6 tf.functionで性能アップ</a></li>
</ul></li>
    <li class="toctree-l4 current"><button class="section nav-item">画像</button>
<ul class="subnav">
    <li class="toctree-l5 current"><a class="nav-item current" href="./">1 畳み込みニューラルネットワーク</a>
<ul class="subnav">
<li class="toctree-l6"><a class="nav-item toc" href="#11-mnist">1.1 MNISTデータセットのダウンロードと準備</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#12">1.2 畳み込みの基礎部分の作成</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#13-dense">1.3 上にDenseレイヤーを追加</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#14">1.4 モデルのコンパイルと学習</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#15">1.5 モデルの評価</a></li>
</ul></li>
    <li class="toctree-l5"><a class="nav-item" href="../画像分類/">2 画像分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../TF.Hubによる転移学習/">3 TF.Hubによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../学習済CNNによる転移学習/">4 学習済CNNによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../画像セグメンテーション/">5 画像セグメンテーション</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../TF.Hubによるオブジェクト検出/">6 TF.Hubによるオブジェクト検出</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/machine-learning/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../../カスタマイズ/tf.functionで性能アップ/">&laquo; Previous</a></div>
    <div class="next"><a href="../画像分類/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../../../.." class="site-name"> Machine Learning</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>TensorFlow &raquo; </li><li>チュートリアル &raquo; </li><li>詳細 &raquo; </li><li>画像</li>
</ul>
</nav>
                <div id="content">
<h1 id="1"><span class="pheasant-header"><span class="header"><span class="number">1</span> <span class="title">畳み込みニューラルネットワーク</span><span class="link"><a href="https://www.tensorflow.org/tutorials/images/cnn" target="_blank" title="https://www.tensorflow.org/tutorials/images/cnn"></a></span></span></span></h1>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">from tensorflow.keras import datasets, layers, models</code></pre></div>
<div class="report"><p><span class="count">[1]</span>
<span class="start">2019-11-10 09:55:47</span> (<span class="time">1.95s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min42s</span>)</span></p></div></div></div></div>

<p>gpu = tf.config.experimental.list_physical_devices('GPU')[0] tf.config.experimental.set_memory_growth(gpu, True)</p>
<h2 id="11-mnist"><span class="pheasant-header"><span class="header"><span class="number">1.1</span> <span class="title">MNISTデータセットのダウンロードと準備</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">(train_images, train_labels), (test_images, test_labels) = datasets.mnist.load_data()

train_images = train_images.reshape((60000, 28, 28, 1))
test_images = test_images.reshape((10000, 28, 28, 1))

# ピクセルの値を 0~1 の間に正規化
train_images, test_images = train_images / 255.0, test_images / 255.0</code></pre></div>
<div class="report"><p><span class="count">[2]</span>
<span class="start">2019-11-10 09:55:49</span> (<span class="time">479ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min42s</span>)</span></p></div></div></div></div>

<h2 id="12"><span class="pheasant-header"><span class="header"><span class="number">1.2</span> <span class="title">畳み込みの基礎部分の作成</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">model = models.Sequential()
model.add(layers.Conv2D(32, (3, 3), activation=&#34;relu&#34;, input_shape=(28, 28, 1)))
model.add(layers.MaxPooling2D((2, 2)))
model.add(layers.Conv2D(64, (3, 3), activation=&#34;relu&#34;))
model.add(layers.MaxPooling2D((2, 2)))
model.add(layers.Conv2D(64, (3, 3), activation=&#34;relu&#34;))</code></pre></div>
<div class="report"><p><span class="count">[3]</span>
<span class="start">2019-11-10 09:55:49</span> (<span class="time">1.17s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min44s</span>)</span></p></div></div></div></div>

<h2 id="13-dense"><span class="pheasant-header"><span class="header"><span class="number">1.3</span> <span class="title">上にDenseレイヤーを追加</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">model.add(layers.Flatten())
model.add(layers.Dense(64, activation=&#34;relu&#34;))
model.add(layers.Dense(10, activation=&#34;softmax&#34;))

model.summary()</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2019-11-10 09:55:50</span> (<span class="time">40.3ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3min44s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Model: &#34;sequential&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 26, 26, 32)        320       
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 13, 13, 32)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 11, 11, 64)        18496     
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 5, 5, 64)          0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 3, 3, 64)          36928     
_________________________________________________________________
flatten (Flatten)            (None, 576)               0         
_________________________________________________________________
dense (Dense)                (None, 64)                36928     
_________________________________________________________________
dense_1 (Dense)              (None, 10)                650       
=================================================================
Total params: 93,322
Trainable params: 93,322
Non-trainable params: 0
_________________________________________________________________</code></pre></div></div></div></div>

<h2 id="14"><span class="pheasant-header"><span class="header"><span class="number">1.4</span> <span class="title">モデルのコンパイルと学習</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">model.compile(
    optimizer=&#34;adam&#34;, loss=&#34;sparse_categorical_crossentropy&#34;, metrics=[&#34;accuracy&#34;]
)

model.fit(train_images, train_labels, epochs=5)</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2019-11-10 09:55:50</span> (<span class="time">45.7s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">4min29s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Train on 60000 samples
Epoch 1/5
60000/60000 [==============================] - 11s 179us/sample - loss: 0.1427 - accuracy: 0.9561
Epoch 2/5
60000/60000 [==============================] - 9s 145us/sample - loss: 0.0477 - accuracy: 0.9854
Epoch 3/5
60000/60000 [==============================] - 9s 145us/sample - loss: 0.0339 - accuracy: 0.9894
Epoch 4/5
60000/60000 [==============================] - 9s 145us/sample - loss: 0.0256 - accuracy: 0.9919
Epoch 5/5
60000/60000 [==============================] - 9s 147us/sample - loss: 0.0217 - accuracy: 0.9931</code></pre></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">&lt;tensorflow.python.keras.callbacks.History at 0x1dbbb971788&gt;</code></pre></div></div></div></div>

<h2 id="15"><span class="pheasant-header"><span class="header"><span class="number">1.5</span> <span class="title">モデルの評価</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">test_loss, test_acc = model.evaluate(test_images, test_labels, verbose=2)
test_acc</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2019-11-10 09:56:36</span> (<span class="time">1.08s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">4min30s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">10000/1 - 1s - loss: 0.0166 - accuracy: 0.9904</code></pre></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">0.9904</code></pre></div></div></div></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../../カスタマイズ/tf.functionで性能アップ/" title="6 tf.functionで性能アップ"><span>Previous</span></a></div>
        <div class="next"><a href="../画像分類/" title="2 画像分類"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>
        var base_url = '.';
    </script>
    <script src="../../../../../js/theme.js"></script>
    <script src="../../../../../js/pheasant.js"></script>
</body>

</html>