<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../../../../../img/favicon.ico">
    <title>3 映画レビューのテキスト分類 &mdash; Machine Learning</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../../../.." class="site-name"> Machine Learning</a>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../../../..">機械学習自習室</a></li>
                    <li class="toctree-l1"><button class="section nav-item">TensorFlow</button>
<ul class="subnav">
    <li class="toctree-l2 current"><button class="section nav-item">チュートリアル</button>
<ul class="subnav">
    <li class="toctree-l3 current"><button class="section nav-item">初級</button>
<ul class="subnav">
    <li class="toctree-l4 current"><button class="section nav-item">KerasによるMLの基本</button>
<ul class="subnav">
    <li class="toctree-l5"><a class="nav-item" href="../基本的な画像分類/">1 基本的な画像の分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../TF.Hubによるテキスト分類/">2 TF.Hubによるテキスト分類</a></li>
    <li class="toctree-l5 current"><a class="nav-item current" href="./">3 映画レビューのテキスト分類</a>
<ul class="subnav">
<li class="toctree-l6"><a class="nav-item toc" href="#31-imdb-dataset">3.1 IMDB datasetのダウンロード</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#32">3.2 データの観察</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#33">3.3 データの準備</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#34">3.4 モデルの構築</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#35">3.5 検証用データを作る</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#36">3.6 モデルの訓練</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#37">3.7 モデルの評価</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#38">3.8 正解率と損失の時系列グラフを描く</a></li>
</ul></li>
    <li class="toctree-l5"><a class="nav-item" href="../回帰：燃費を予測する/">4 回帰：燃費を予測する</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../過学習と学習不足/">5 過学習と学習不足</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../モデルの保存と復元/">6 モデルの保存と復元</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">データの読み込みと前処理</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../データの読み込みと前処理/CSV/">1 CSV</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../データの読み込みと前処理/NumPy/">2 NumPy</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../データの読み込みと前処理/pandas.DataFrame/">3 pandas.DataFrame</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../データの読み込みと前処理/画像/">4 画像</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../データの読み込みと前処理/テキスト/">5 テキスト</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">詳細</button>
<ul class="subnav hide">
    <li class="toctree-l4"><button class="section nav-item hide">カスタマイズ</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/テンソルと演算/">1 テンソルと演算</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/カスタムレイヤー/">2 カスタムレイヤー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/自動微分と勾配テープ/">3 自動微分と勾配テープ</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/カスタム訓練：基本/">4 カスタム訓練：基本</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/カスタム訓練：ウォークスルー/">5 カスタム訓練：ウォークスルー</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/tf.functionで性能アップ/">6 tf.functionで性能アップ</a></li>
</ul></li>
    <li class="toctree-l4"><button class="section nav-item hide">画像</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/畳み込みニューラルネットワーク/">1 畳み込みニューラルネットワーク</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/画像分類/">2 画像分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/TF.Hubによる転移学習/">3 TF.Hubによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/学習済CNNによる転移学習/">4 学習済CNNによる転移学習</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/画像セグメンテーション/">5 画像セグメンテーション</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/画像/TF.Hubによるオブジェクト検出/">6 TF.Hubによるオブジェクト検出</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/machine-learning/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../TF.Hubによるテキスト分類/">&laquo; Previous</a></div>
    <div class="next"><a href="../回帰：燃費を予測する/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../../../.." class="site-name"> Machine Learning</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>TensorFlow &raquo; </li><li>チュートリアル &raquo; </li><li>初級 &raquo; </li><li>KerasによるMLの基本</li>
</ul>
</nav>
                <div id="content"><style>
 .vega-actions a { margin-right: 12px; color: #757575; font-weight: normal; font-size: 13px; } .error { color: red; } </style>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.4.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@4"></script>
<h1 id="3"><span class="pheasant-header"><span class="header"><span class="number">3</span> <span class="title">映画レビューのテキスト分類</span><span class="link"><a href="https://www.tensorflow.org/tutorials/keras/text_classification" target="_blank" title="https://www.tensorflow.org/tutorials/keras/text_classification"></a></span></span></span></h1>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import altair as alt
import pandas as pd
from tensorflow import keras</code></pre></div>
<div class="report"><p><span class="count">[1]</span>
<span class="start">2019-11-10 09:31:27</span> (<span class="time">1.93s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min2s</span>)</span></p></div></div></div></div>

<h2 id="31-imdb-dataset"><span class="pheasant-header"><span class="header"><span class="number">3.1</span> <span class="title">IMDB datasetのダウンロード</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">imdb = keras.datasets.imdb
(train_data, train_labels), (test_data, test_labels) = imdb.load_data(num_words=10000)</code></pre></div>
<div class="report"><p><span class="count">[2]</span>
<span class="start">2019-11-10 09:31:29</span> (<span class="time">3.62s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min6s</span>)</span></p></div></div></div></div>

<h2 id="32"><span class="pheasant-header"><span class="header"><span class="number">3.2</span> <span class="title">データの観察</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">print(f&#34;Training entries: {len(train_data)}, labels: {len(train_labels)}&#34;)
print(train_data[0])</code></pre></div>
<div class="report"><p><span class="count">[3]</span>
<span class="start">2019-11-10 09:31:33</span> (<span class="time">34.9ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min6s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Training entries: 25000, labels: 25000
[1, 14, 22, 16, 43, 530, 973, 1622, 1385, 65, 458, 4468, 66, 3941, 4, 173, 36, 256, 5, 25, 100, 43, 838, 112, 50, 670, 2, 9, 35, 480, 284, 5, 150, 4, 172, 112, 167, 2, 336, 385, 39, 4, 172, 4536, 1111, 17, 546, 38, 13, 447, 4, 192, 50, 16, 6, 147, 2025, 19, 14, 22, 4, 1920, 4613, 469, 4, 22, 71, 87, 12, 16, 43, 530, 38, 76, 15, 13, 1247, 4, 22, 17, 515, 17, 12, 16, 626, 18, 2, 5, 62, 386, 12, 8, 316, 8, 106, 5, 4, 2223, 5244, 16, 480, 66, 3785, 33, 4, 130, 12, 16, 38, 619, 5, 25, 124, 51, 36, 135, 48, 25, 1415, 33, 6, 22, 12, 215, 28, 77, 52, 5, 14, 407, 16, 82, 2, 8, 4, 107, 117, 5952, 15, 256, 4, 2, 7, 3766, 5, 723, 36, 71, 43, 530, 476, 26, 400, 317, 46, 7, 4, 2, 1029, 13, 104, 88, 4, 381, 15, 297, 98, 32, 2071, 56, 26, 141, 6, 194, 7486, 18, 4, 226, 22, 21, 134, 476, 26, 480, 5, 144, 30, 5535, 18, 51, 36, 28, 224, 92, 25, 104, 4, 226, 65, 16, 38, 1334, 88, 12, 16, 283, 5, 16, 4472, 113, 103, 32, 15, 16, 5345, 19, 178, 32]</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># レビューごとに長さが異なる。
len(train_data[0]), len(train_data[1])</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2019-11-10 09:31:33</span> (<span class="time">31.2ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min6s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(218, 189)</code></pre></div></div></div></div>

<h3 id="321"><span class="pheasant-header"><span class="header"><span class="number">3.2.1</span> <span class="title">整数を単語に戻してみる</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># 単語を整数にマッピングする辞書
word_index = imdb.get_word_index()

# インデックスの最初の方は予約済み
word_index = {k: (v + 3) for k, v in word_index.items()}
word_index[&#34;&lt;PAD&gt;&#34;] = 0
word_index[&#34;&lt;START&gt;&#34;] = 1
word_index[&#34;&lt;UNK&gt;&#34;] = 2  # unknown
word_index[&#34;&lt;UNUSED&gt;&#34;] = 3

reverse_word_index = dict([(value, key) for (key, value) in word_index.items()])

def decode_review(text):
    return &#34; &#34;.join([reverse_word_index.get(i, &#34;?&#34;) for i in text])

decode_review(train_data[0])</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2019-11-10 09:31:33</span> (<span class="time">141ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min6s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">&#34;&lt;START&gt; this film was just brilliant casting location scenery story direction everyone&#39;s really suited the part they played and you could just imagine being there robert &lt;UNK&gt; is an amazing actor and now the same being director &lt;UNK&gt; father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for &lt;UNK&gt; and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also &lt;UNK&gt; to the two little boy&#39;s that played the &lt;UNK&gt; of norman and paul they were just brilliant children are often left out of the &lt;UNK&gt; list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&#39;t you think the whole story was so lovely because it was true and was someone&#39;s life after all that was shared with us all&#34;</code></pre></div></div></div></div>

<h2 id="33"><span class="pheasant-header"><span class="header"><span class="number">3.3</span> <span class="title">データの準備</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">#  長さを標準化する
train_data = keras.preprocessing.sequence.pad_sequences(
    train_data, value=word_index[&#34;&lt;PAD&gt;&#34;], padding=&#34;post&#34;, maxlen=256
)

test_data = keras.preprocessing.sequence.pad_sequences(
    test_data, value=word_index[&#34;&lt;PAD&gt;&#34;], padding=&#34;post&#34;, maxlen=256
)
len(train_data[0]), len(train_data[1])</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2019-11-10 09:31:33</span> (<span class="time">751ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min7s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(256, 256)</code></pre></div></div></div></div>

<h2 id="34"><span class="pheasant-header"><span class="header"><span class="number">3.4</span> <span class="title">モデルの構築</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># 入力の形式は映画レビューで使われている語彙数（10,000語）
vocab_size = 10000
model = keras.Sequential()
model.add(keras.layers.Embedding(vocab_size, 16))
model.add(keras.layers.GlobalAveragePooling1D())
model.add(keras.layers.Dense(16, activation=&#34;relu&#34;))
model.add(keras.layers.Dense(1, activation=&#34;sigmoid&#34;))
model.summary()</code></pre></div>
<div class="report"><p><span class="count">[7]</span>
<span class="start">2019-11-10 09:31:34</span> (<span class="time">1.56s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min8s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Model: &#34;sequential&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding (Embedding)        (None, None, 16)          160000    
_________________________________________________________________
global_average_pooling1d (Gl (None, 16)                0         
_________________________________________________________________
dense (Dense)                (None, 16)                272       
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 17        
=================================================================
Total params: 160,289
Trainable params: 160,289
Non-trainable params: 0
_________________________________________________________________</code></pre></div></div></div></div>

<h3 id="341"><span class="pheasant-header"><span class="header"><span class="number">3.4.1</span> <span class="title">損失関数とオプティマイザ</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">model.compile(optimizer=&#34;adam&#34;, loss=&#34;binary_crossentropy&#34;, metrics=[&#34;accuracy&#34;])</code></pre></div>
<div class="report"><p><span class="count">[8]</span>
<span class="start">2019-11-10 09:31:35</span> (<span class="time">68.4ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min8s</span>)</span></p></div></div></div></div>

<h2 id="35"><span class="pheasant-header"><span class="header"><span class="number">3.5</span> <span class="title">検証用データを作る</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">x_val = train_data[:10000]
partial_x_train = train_data[10000:]
y_val = train_labels[:10000]
partial_y_train = train_labels[10000:]</code></pre></div>
<div class="report"><p><span class="count">[9]</span>
<span class="start">2019-11-10 09:31:35</span> (<span class="time">15.5ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min8s</span>)</span></p></div></div></div></div>

<h2 id="36"><span class="pheasant-header"><span class="header"><span class="number">3.6</span> <span class="title">モデルの訓練</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">history = model.fit(
    partial_x_train,
    partial_y_train,
    epochs=40,
    batch_size=512,
    validation_data=(x_val, y_val),
    verbose=1,
)</code></pre></div>
<div class="report"><p><span class="count">[10]</span>
<span class="start">2019-11-10 09:31:35</span> (<span class="time">35.4s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min44s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Train on 15000 samples, validate on 10000 samples
Epoch 1/40
15000/15000 [==============================] - 2s 117us/sample - loss: 0.6922 - accuracy: 0.5035 - val_loss: 0.6907 - val_accuracy: 0.5453
Epoch 2/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.6875 - accuracy: 0.6056 - val_loss: 0.6842 - val_accuracy: 0.6540
Epoch 3/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.6773 - accuracy: 0.6794 - val_loss: 0.6718 - val_accuracy: 0.6950
Epoch 4/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.6594 - accuracy: 0.7145 - val_loss: 0.6514 - val_accuracy: 0.7411
Epoch 5/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.6317 - accuracy: 0.7653 - val_loss: 0.6208 - val_accuracy: 0.7705
Epoch 6/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.5934 - accuracy: 0.7995 - val_loss: 0.5827 - val_accuracy: 0.7957
Epoch 7/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.5492 - accuracy: 0.8224 - val_loss: 0.5406 - val_accuracy: 0.8157
Epoch 8/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.5028 - accuracy: 0.8428 - val_loss: 0.4992 - val_accuracy: 0.8305
Epoch 9/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.4581 - accuracy: 0.8574 - val_loss: 0.4612 - val_accuracy: 0.8395
Epoch 10/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.4176 - accuracy: 0.8715 - val_loss: 0.4280 - val_accuracy: 0.8487
Epoch 11/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.3822 - accuracy: 0.8815 - val_loss: 0.4004 - val_accuracy: 0.8568
Epoch 12/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.3522 - accuracy: 0.8877 - val_loss: 0.3783 - val_accuracy: 0.8620
Epoch 13/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.3265 - accuracy: 0.8945 - val_loss: 0.3598 - val_accuracy: 0.8685
Epoch 14/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.3046 - accuracy: 0.8997 - val_loss: 0.3449 - val_accuracy: 0.8723
Epoch 15/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2857 - accuracy: 0.9047 - val_loss: 0.3339 - val_accuracy: 0.8732
Epoch 16/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.2698 - accuracy: 0.9097 - val_loss: 0.3245 - val_accuracy: 0.8755
Epoch 17/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.2547 - accuracy: 0.9144 - val_loss: 0.3156 - val_accuracy: 0.8794
Epoch 18/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.2415 - accuracy: 0.9182 - val_loss: 0.3092 - val_accuracy: 0.8793
Epoch 19/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2295 - accuracy: 0.9229 - val_loss: 0.3040 - val_accuracy: 0.8795
Epoch 20/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.2187 - accuracy: 0.9263 - val_loss: 0.3006 - val_accuracy: 0.8808
Epoch 21/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2091 - accuracy: 0.9301 - val_loss: 0.2963 - val_accuracy: 0.8832
Epoch 22/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.2000 - accuracy: 0.9316 - val_loss: 0.2924 - val_accuracy: 0.8833
Epoch 23/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1913 - accuracy: 0.9373 - val_loss: 0.2907 - val_accuracy: 0.8839
Epoch 24/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1828 - accuracy: 0.9405 - val_loss: 0.2888 - val_accuracy: 0.8846
Epoch 25/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1748 - accuracy: 0.9443 - val_loss: 0.2875 - val_accuracy: 0.8842
Epoch 26/40
15000/15000 [==============================] - 1s 56us/sample - loss: 0.1678 - accuracy: 0.9470 - val_loss: 0.2868 - val_accuracy: 0.8857
Epoch 27/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1611 - accuracy: 0.9486 - val_loss: 0.2862 - val_accuracy: 0.8857
Epoch 28/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1543 - accuracy: 0.9528 - val_loss: 0.2877 - val_accuracy: 0.8839
Epoch 29/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1487 - accuracy: 0.9544 - val_loss: 0.2865 - val_accuracy: 0.8864
Epoch 30/40
15000/15000 [==============================] - 1s 56us/sample - loss: 0.1430 - accuracy: 0.9568 - val_loss: 0.2871 - val_accuracy: 0.8870
Epoch 31/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1371 - accuracy: 0.9595 - val_loss: 0.2882 - val_accuracy: 0.8867
Epoch 32/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1315 - accuracy: 0.9611 - val_loss: 0.2907 - val_accuracy: 0.8844
Epoch 33/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1271 - accuracy: 0.9636 - val_loss: 0.2910 - val_accuracy: 0.8862
Epoch 34/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1218 - accuracy: 0.9663 - val_loss: 0.2926 - val_accuracy: 0.8862
Epoch 35/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1173 - accuracy: 0.9671 - val_loss: 0.2952 - val_accuracy: 0.8855
Epoch 36/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1131 - accuracy: 0.9690 - val_loss: 0.2968 - val_accuracy: 0.8854
Epoch 37/40
15000/15000 [==============================] - 1s 56us/sample - loss: 0.1087 - accuracy: 0.9711 - val_loss: 0.2994 - val_accuracy: 0.8857
Epoch 38/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1049 - accuracy: 0.9711 - val_loss: 0.3034 - val_accuracy: 0.8842
Epoch 39/40
15000/15000 [==============================] - 1s 57us/sample - loss: 0.1009 - accuracy: 0.9731 - val_loss: 0.3061 - val_accuracy: 0.8816
Epoch 40/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.0971 - accuracy: 0.9742 - val_loss: 0.3074 - val_accuracy: 0.8842</code></pre></div></div></div></div>

<h2 id="37"><span class="pheasant-header"><span class="header"><span class="number">3.7</span> <span class="title">モデルの評価</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results = model.evaluate(test_data, test_labels, verbose=2)
print(results)</code></pre></div>
<div class="report"><p><span class="count">[11]</span>
<span class="start">2019-11-10 09:32:11</span> (<span class="time">1.85s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min45s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">25000/1 - 2s - loss: 0.3311 - accuracy: 0.8724
[0.326629624209404, 0.8724]</code></pre></div></div></div></div>

<h2 id="38"><span class="pheasant-header"><span class="header"><span class="number">3.8</span> <span class="title">正解率と損失の時系列グラフを描く</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">df = pd.DataFrame(history.history)
df.index.name = &#34;epoch&#34;
df.reset_index(inplace=True)
df = pd.melt(df, id_vars=[&#34;epoch&#34;], value_vars=[&#34;accuracy&#34;, &#34;val_accuracy&#34;])
chart = alt.Chart(df).mark_line(point=True).properties(width=200, height=150)
chart.encode(
    x=&#34;epoch&#34;, y=alt.Y(&#34;value&#34;, scale=alt.Scale(domain=[0.5, 1])), color=&#34;variable&#34;
)</code></pre></div>
<div class="report"><p><span class="count">[12]</span>
<span class="start">2019-11-10 09:32:13</span> (<span class="time">62.5ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min46s</span>)</span></p></div></div>

<div class="cell jupyter display"><div class="content"><div id="pheasant-altair-1"><script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-01292f2ad4e86c9ac313e73d27c4f580"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "epoch"}, "y": {"type": "quantitative", "field": "value", "scale": {"domain": [0.5, 1]}}}, "height": 150, "width": 200, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-01292f2ad4e86c9ac313e73d27c4f580": [{"epoch": 0, "variable": "accuracy", "value": 0.5034666657447815}, {"epoch": 1, "variable": "accuracy", "value": 0.6055999994277954}, {"epoch": 2, "variable": "accuracy", "value": 0.6794000267982483}, {"epoch": 3, "variable": "accuracy", "value": 0.7144666910171509}, {"epoch": 4, "variable": "accuracy", "value": 0.7652666568756104}, {"epoch": 5, "variable": "accuracy", "value": 0.7995333075523376}, {"epoch": 6, "variable": "accuracy", "value": 0.8223999738693237}, {"epoch": 7, "variable": "accuracy", "value": 0.8428000211715698}, {"epoch": 8, "variable": "accuracy", "value": 0.8574000000953674}, {"epoch": 9, "variable": "accuracy", "value": 0.8714666962623596}, {"epoch": 10, "variable": "accuracy", "value": 0.8815333247184753}, {"epoch": 11, "variable": "accuracy", "value": 0.8877333402633667}, {"epoch": 12, "variable": "accuracy", "value": 0.8945333361625671}, {"epoch": 13, "variable": "accuracy", "value": 0.8996666669845581}, {"epoch": 14, "variable": "accuracy", "value": 0.9047333598136902}, {"epoch": 15, "variable": "accuracy", "value": 0.9097333550453186}, {"epoch": 16, "variable": "accuracy", "value": 0.9143999814987183}, {"epoch": 17, "variable": "accuracy", "value": 0.9182000160217285}, {"epoch": 18, "variable": "accuracy", "value": 0.9228666424751282}, {"epoch": 19, "variable": "accuracy", "value": 0.9262666702270508}, {"epoch": 20, "variable": "accuracy", "value": 0.9300666451454163}, {"epoch": 21, "variable": "accuracy", "value": 0.9315999746322632}, {"epoch": 22, "variable": "accuracy", "value": 0.9372666478157043}, {"epoch": 23, "variable": "accuracy", "value": 0.9404666423797607}, {"epoch": 24, "variable": "accuracy", "value": 0.9443333148956299}, {"epoch": 25, "variable": "accuracy", "value": 0.9470000267028809}, {"epoch": 26, "variable": "accuracy", "value": 0.9485999941825867}, {"epoch": 27, "variable": "accuracy", "value": 0.9527999758720398}, {"epoch": 28, "variable": "accuracy", "value": 0.9544000029563904}, {"epoch": 29, "variable": "accuracy", "value": 0.9567999839782715}, {"epoch": 30, "variable": "accuracy", "value": 0.9595333337783813}, {"epoch": 31, "variable": "accuracy", "value": 0.9610666632652283}, {"epoch": 32, "variable": "accuracy", "value": 0.9635999798774719}, {"epoch": 33, "variable": "accuracy", "value": 0.9662666916847229}, {"epoch": 34, "variable": "accuracy", "value": 0.9671333432197571}, {"epoch": 35, "variable": "accuracy", "value": 0.968999981880188}, {"epoch": 36, "variable": "accuracy", "value": 0.9710666537284851}, {"epoch": 37, "variable": "accuracy", "value": 0.9711333513259888}, {"epoch": 38, "variable": "accuracy", "value": 0.9730666875839233}, {"epoch": 39, "variable": "accuracy", "value": 0.9742000102996826}, {"epoch": 0, "variable": "val_accuracy", "value": 0.5453000068664551}, {"epoch": 1, "variable": "val_accuracy", "value": 0.6539999842643738}, {"epoch": 2, "variable": "val_accuracy", "value": 0.6949999928474426}, {"epoch": 3, "variable": "val_accuracy", "value": 0.741100013256073}, {"epoch": 4, "variable": "val_accuracy", "value": 0.7705000042915344}, {"epoch": 5, "variable": "val_accuracy", "value": 0.7957000136375427}, {"epoch": 6, "variable": "val_accuracy", "value": 0.8156999945640564}, {"epoch": 7, "variable": "val_accuracy", "value": 0.8305000066757202}, {"epoch": 8, "variable": "val_accuracy", "value": 0.8395000100135803}, {"epoch": 9, "variable": "val_accuracy", "value": 0.8486999869346619}, {"epoch": 10, "variable": "val_accuracy", "value": 0.8568000197410583}, {"epoch": 11, "variable": "val_accuracy", "value": 0.8619999885559082}, {"epoch": 12, "variable": "val_accuracy", "value": 0.8684999942779541}, {"epoch": 13, "variable": "val_accuracy", "value": 0.8723000288009644}, {"epoch": 14, "variable": "val_accuracy", "value": 0.873199999332428}, {"epoch": 15, "variable": "val_accuracy", "value": 0.8755000233650208}, {"epoch": 16, "variable": "val_accuracy", "value": 0.8794000148773193}, {"epoch": 17, "variable": "val_accuracy", "value": 0.8792999982833862}, {"epoch": 18, "variable": "val_accuracy", "value": 0.8794999718666077}, {"epoch": 19, "variable": "val_accuracy", "value": 0.8808000087738037}, {"epoch": 20, "variable": "val_accuracy", "value": 0.8831999897956848}, {"epoch": 21, "variable": "val_accuracy", "value": 0.8833000063896179}, {"epoch": 22, "variable": "val_accuracy", "value": 0.883899986743927}, {"epoch": 23, "variable": "val_accuracy", "value": 0.8845999836921692}, {"epoch": 24, "variable": "val_accuracy", "value": 0.8841999769210815}, {"epoch": 25, "variable": "val_accuracy", "value": 0.885699987411499}, {"epoch": 26, "variable": "val_accuracy", "value": 0.885699987411499}, {"epoch": 27, "variable": "val_accuracy", "value": 0.883899986743927}, {"epoch": 28, "variable": "val_accuracy", "value": 0.8863999843597412}, {"epoch": 29, "variable": "val_accuracy", "value": 0.8870000243186951}, {"epoch": 30, "variable": "val_accuracy", "value": 0.8866999745368958}, {"epoch": 31, "variable": "val_accuracy", "value": 0.8844000101089478}, {"epoch": 32, "variable": "val_accuracy", "value": 0.8862000107765198}, {"epoch": 33, "variable": "val_accuracy", "value": 0.8862000107765198}, {"epoch": 34, "variable": "val_accuracy", "value": 0.8855000138282776}, {"epoch": 35, "variable": "val_accuracy", "value": 0.8853999972343445}, {"epoch": 36, "variable": "val_accuracy", "value": 0.885699987411499}, {"epoch": 37, "variable": "val_accuracy", "value": 0.8841999769210815}, {"epoch": 38, "variable": "val_accuracy", "value": 0.881600022315979}, {"epoch": 39, "variable": "val_accuracy", "value": 0.8841999769210815}]}};
    var opt = {
      "mode": "vega-lite",
      "renderer": "canvas",
      "actions": {"editor": true, "source": true, "export": true}
    };
    vegaEmbed("#pheasant-altair-1", spec, opt).catch(console.err);
  });</script></div></div></div></div></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../TF.Hubによるテキスト分類/" title="2 TF.Hubによるテキスト分類"><span>Previous</span></a></div>
        <div class="next"><a href="../回帰：燃費を予測する/" title="4 回帰：燃費を予測する"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>
        var base_url = '.';
    </script>
    <script src="../../../../../js/theme.js"></script>
    <script src="../../../../../js/pheasant.js"></script>
</body>

</html>