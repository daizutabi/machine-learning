<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../../../../../img/favicon.ico">
    <title>3 映画レビューのテキスト分類 &mdash; Machine Learning</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../../../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../../../.." class="site-name"> Machine Learning</a>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../../../..">機械学習自習室</a></li>
                    <li class="toctree-l1"><button class="section nav-item">TensorFlow</button>
<ul class="subnav">
    <li class="toctree-l2 current"><button class="section nav-item">チュートリアル</button>
<ul class="subnav">
    <li class="toctree-l3 current"><button class="section nav-item">初級</button>
<ul class="subnav">
    <li class="toctree-l4 current"><button class="section nav-item">KerasによるMLの基本</button>
<ul class="subnav">
    <li class="toctree-l5"><a class="nav-item" href="../基本的な画像分類/">1 基本的な画像の分類</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../TF.Hubによるテキスト分類/">2 TF.Hubによるテキスト分類</a></li>
    <li class="toctree-l5 current"><a class="nav-item current" href="./">3 映画レビューのテキスト分類</a>
<ul class="subnav">
<li class="toctree-l6"><a class="nav-item toc" href="#31-imdb-dataset">3.1 IMDB datasetのダウンロード</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#32">3.2 データの観察</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#33">3.3 データの準備</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#34">3.4 モデルの構築</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#35">3.5 検証用データを作る</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#36">3.6 モデルの訓練</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#37">3.7 モデルの評価</a></li>
<li class="toctree-l6"><a class="nav-item toc" href="#38">3.8 正解率と損失の時系列グラフを描く</a></li>
</ul></li>
    <li class="toctree-l5"><a class="nav-item" href="../回帰：燃費を予測する/">4 回帰：燃費を予測する</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../過学習と学習不足/">5 過学習と学習不足</a></li>
    <li class="toctree-l5"><a class="nav-item" href="../モデルの保存と復元/">6 モデルの保存と復元</a></li>
</ul></li>
</ul></li>
    <li class="toctree-l3"><button class="section nav-item hide">詳細</button>
<ul class="subnav hide">
    <li class="toctree-l4"><button class="section nav-item hide">カスタマイズ</button>
<ul class="subnav hide">
    <li class="toctree-l5"><a class="nav-item" href="../../../詳細/カスタマイズ/テンソルと演算/">1 テンソルと演算</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/machine-learning/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../TF.Hubによるテキスト分類/">&laquo; Previous</a></div>
    <div class="next"><a href="../回帰：燃費を予測する/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../../../.." class="site-name"> Machine Learning</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>TensorFlow &raquo; </li><li>チュートリアル &raquo; </li><li>初級 &raquo; </li><li>KerasによるMLの基本</li>
</ul>
</nav>
                <div id="content"><style>
 .vega-actions a { margin-right: 12px; color: #757575; font-weight: normal; font-size: 13px; } .error { color: red; } </style>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@3.4.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@4"></script>
<h1 id="3"><span class="pheasant-header"><span class="header"><span class="number">3</span> <span class="title">映画レビューのテキスト分類</span></span></span></h1>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import altair as alt
import pandas as pd
from tensorflow import keras</code></pre></div>
<div class="report"><p><span class="count">[1]</span>
<span class="start">2019-11-08 22:10:56</span> (<span class="time">1.94s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min6s</span>)</span></p></div></div></div></div>

<h2 id="31-imdb-dataset"><span class="pheasant-header"><span class="header"><span class="number">3.1</span> <span class="title">IMDB datasetのダウンロード</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">imdb = keras.datasets.imdb
(train_data, train_labels), (test_data, test_labels) = imdb.load_data(num_words=10000)</code></pre></div>
<div class="report"><p><span class="count">[2]</span>
<span class="start">2019-11-08 22:10:58</span> (<span class="time">4.21s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min10s</span>)</span></p></div></div></div></div>

<h2 id="32"><span class="pheasant-header"><span class="header"><span class="number">3.2</span> <span class="title">データの観察</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">print(f&#34;Training entries: {len(train_data)}, labels: {len(train_labels)}&#34;)
print(train_data[0])</code></pre></div>
<div class="report"><p><span class="count">[3]</span>
<span class="start">2019-11-08 22:11:03</span> (<span class="time">12.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min10s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Training entries: 25000, labels: 25000
[1, 14, 22, 16, 43, 530, 973, 1622, 1385, 65, 458, 4468, 66, 3941, 4, 173, 36, 256, 5, 25, 100, 43, 838, 112, 50, 670, 2, 9, 35, 480, 284, 5, 150, 4, 172, 112, 167, 2, 336, 385, 39, 4, 172, 4536, 1111, 17, 546, 38, 13, 447, 4, 192, 50, 16, 6, 147, 2025, 19, 14, 22, 4, 1920, 4613, 469, 4, 22, 71, 87, 12, 16, 43, 530, 38, 76, 15, 13, 1247, 4, 22, 17, 515, 17, 12, 16, 626, 18, 2, 5, 62, 386, 12, 8, 316, 8, 106, 5, 4, 2223, 5244, 16, 480, 66, 3785, 33, 4, 130, 12, 16, 38, 619, 5, 25, 124, 51, 36, 135, 48, 25, 1415, 33, 6, 22, 12, 215, 28, 77, 52, 5, 14, 407, 16, 82, 2, 8, 4, 107, 117, 5952, 15, 256, 4, 2, 7, 3766, 5, 723, 36, 71, 43, 530, 476, 26, 400, 317, 46, 7, 4, 2, 1029, 13, 104, 88, 4, 381, 15, 297, 98, 32, 2071, 56, 26, 141, 6, 194, 7486, 18, 4, 226, 22, 21, 134, 476, 26, 480, 5, 144, 30, 5535, 18, 51, 36, 28, 224, 92, 25, 104, 4, 226, 65, 16, 38, 1334, 88, 12, 16, 283, 5, 16, 4472, 113, 103, 32, 15, 16, 5345, 19, 178, 32]</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># レビューごとに長さが異なる。
len(train_data[0]), len(train_data[1])</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2019-11-08 22:11:03</span> (<span class="time">12.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min10s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(218, 189)</code></pre></div></div></div></div>

<h3 id="321"><span class="pheasant-header"><span class="header"><span class="number">3.2.1</span> <span class="title">整数を単語に戻してみる</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># 単語を整数にマッピングする辞書
word_index = imdb.get_word_index()

# インデックスの最初の方は予約済み
word_index = {k: (v + 3) for k, v in word_index.items()}
word_index[&#34;&lt;PAD&gt;&#34;] = 0
word_index[&#34;&lt;START&gt;&#34;] = 1
word_index[&#34;&lt;UNK&gt;&#34;] = 2  # unknown
word_index[&#34;&lt;UNUSED&gt;&#34;] = 3

reverse_word_index = dict([(value, key) for (key, value) in word_index.items()])

def decode_review(text):
    return &#34; &#34;.join([reverse_word_index.get(i, &#34;?&#34;) for i in text])

decode_review(train_data[0])</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2019-11-08 22:11:03</span> (<span class="time">139ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min11s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">&#34;&lt;START&gt; this film was just brilliant casting location scenery story direction everyone&#39;s really suited the part they played and you could just imagine being there robert &lt;UNK&gt; is an amazing actor and now the same being director &lt;UNK&gt; father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for &lt;UNK&gt; and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also &lt;UNK&gt; to the two little boy&#39;s that played the &lt;UNK&gt; of norman and paul they were just brilliant children are often left out of the &lt;UNK&gt; list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&#39;t you think the whole story was so lovely because it was true and was someone&#39;s life after all that was shared with us all&#34;</code></pre></div></div></div></div>

<h2 id="33"><span class="pheasant-header"><span class="header"><span class="number">3.3</span> <span class="title">データの準備</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">#  長さを標準化する
train_data = keras.preprocessing.sequence.pad_sequences(
    train_data, value=word_index[&#34;&lt;PAD&gt;&#34;], padding=&#34;post&#34;, maxlen=256
)

test_data = keras.preprocessing.sequence.pad_sequences(
    test_data, value=word_index[&#34;&lt;PAD&gt;&#34;], padding=&#34;post&#34;, maxlen=256
)
len(train_data[0]), len(train_data[1])</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2019-11-08 22:11:03</span> (<span class="time">804ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min11s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(256, 256)</code></pre></div></div></div></div>

<h2 id="34"><span class="pheasant-header"><span class="header"><span class="number">3.4</span> <span class="title">モデルの構築</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># 入力の形式は映画レビューで使われている語彙数（10,000語）
vocab_size = 10000
model = keras.Sequential()
model.add(keras.layers.Embedding(vocab_size, 16))
model.add(keras.layers.GlobalAveragePooling1D())
model.add(keras.layers.Dense(16, activation=&#34;relu&#34;))
model.add(keras.layers.Dense(1, activation=&#34;sigmoid&#34;))
model.summary()</code></pre></div>
<div class="report"><p><span class="count">[7]</span>
<span class="start">2019-11-08 22:11:04</span> (<span class="time">1.59s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min13s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Model: &#34;sequential&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
embedding (Embedding)        (None, None, 16)          160000    
_________________________________________________________________
global_average_pooling1d (Gl (None, 16)                0         
_________________________________________________________________
dense (Dense)                (None, 16)                272       
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 17        
=================================================================
Total params: 160,289
Trainable params: 160,289
Non-trainable params: 0
_________________________________________________________________</code></pre></div></div></div></div>

<h3 id="341"><span class="pheasant-header"><span class="header"><span class="number">3.4.1</span> <span class="title">損失関数とオプティマイザ</span></span></span></h3>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">model.compile(optimizer=&#34;adam&#34;, loss=&#34;binary_crossentropy&#34;, metrics=[&#34;accuracy&#34;])</code></pre></div>
<div class="report"><p><span class="count">[8]</span>
<span class="start">2019-11-08 22:11:05</span> (<span class="time">44.5ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min13s</span>)</span></p></div></div></div></div>

<h2 id="35"><span class="pheasant-header"><span class="header"><span class="number">3.5</span> <span class="title">検証用データを作る</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">x_val = train_data[:10000]
partial_x_train = train_data[10000:]
y_val = train_labels[:10000]
partial_y_train = train_labels[10000:]</code></pre></div>
<div class="report"><p><span class="count">[9]</span>
<span class="start">2019-11-08 22:11:05</span> (<span class="time">5.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min13s</span>)</span></p></div></div></div></div>

<h2 id="36"><span class="pheasant-header"><span class="header"><span class="number">3.6</span> <span class="title">モデルの訓練</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">history = model.fit(
    partial_x_train,
    partial_y_train,
    epochs=40,
    batch_size=512,
    validation_data=(x_val, y_val),
    verbose=1,
)</code></pre></div>
<div class="report"><p><span class="count">[10]</span>
<span class="start">2019-11-08 22:11:05</span> (<span class="time">37.4s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min50s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">Train on 15000 samples, validate on 10000 samples
Epoch 1/40
15000/15000 [==============================] - 2s 136us/sample - loss: 0.6921 - accuracy: 0.5691 - val_loss: 0.6908 - val_accuracy: 0.5382
Epoch 2/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.6877 - accuracy: 0.6209 - val_loss: 0.6842 - val_accuracy: 0.7393
Epoch 3/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.6770 - accuracy: 0.7475 - val_loss: 0.6702 - val_accuracy: 0.7376
Epoch 4/40
15000/15000 [==============================] - 1s 60us/sample - loss: 0.6566 - accuracy: 0.7640 - val_loss: 0.6463 - val_accuracy: 0.7603
Epoch 5/40
15000/15000 [==============================] - 1s 62us/sample - loss: 0.6252 - accuracy: 0.7848 - val_loss: 0.6129 - val_accuracy: 0.7780
Epoch 6/40
15000/15000 [==============================] - 1s 60us/sample - loss: 0.5844 - accuracy: 0.8072 - val_loss: 0.5728 - val_accuracy: 0.7998
Epoch 7/40
15000/15000 [==============================] - 1s 63us/sample - loss: 0.5384 - accuracy: 0.8243 - val_loss: 0.5298 - val_accuracy: 0.8134
Epoch 8/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.4915 - accuracy: 0.8410 - val_loss: 0.4885 - val_accuracy: 0.8296
Epoch 9/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.4474 - accuracy: 0.8557 - val_loss: 0.4519 - val_accuracy: 0.8397
Epoch 10/40
15000/15000 [==============================] - 1s 60us/sample - loss: 0.4082 - accuracy: 0.8697 - val_loss: 0.4200 - val_accuracy: 0.8482
Epoch 11/40
15000/15000 [==============================] - 1s 62us/sample - loss: 0.3745 - accuracy: 0.8785 - val_loss: 0.3941 - val_accuracy: 0.8548
Epoch 12/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.3462 - accuracy: 0.8869 - val_loss: 0.3730 - val_accuracy: 0.8611
Epoch 13/40
15000/15000 [==============================] - 1s 70us/sample - loss: 0.3223 - accuracy: 0.8931 - val_loss: 0.3565 - val_accuracy: 0.8643
Epoch 14/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.3017 - accuracy: 0.8993 - val_loss: 0.3426 - val_accuracy: 0.8692
Epoch 15/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.2842 - accuracy: 0.9033 - val_loss: 0.3313 - val_accuracy: 0.8720
Epoch 16/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2682 - accuracy: 0.9081 - val_loss: 0.3230 - val_accuracy: 0.8749
Epoch 17/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2541 - accuracy: 0.9134 - val_loss: 0.3142 - val_accuracy: 0.8776
Epoch 18/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.2415 - accuracy: 0.9168 - val_loss: 0.3083 - val_accuracy: 0.8801
Epoch 19/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2302 - accuracy: 0.9214 - val_loss: 0.3026 - val_accuracy: 0.8824
Epoch 20/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2194 - accuracy: 0.9257 - val_loss: 0.2985 - val_accuracy: 0.8809
Epoch 21/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2096 - accuracy: 0.9287 - val_loss: 0.2949 - val_accuracy: 0.8833
Epoch 22/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.2010 - accuracy: 0.9319 - val_loss: 0.2928 - val_accuracy: 0.8830
Epoch 23/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1927 - accuracy: 0.9345 - val_loss: 0.2903 - val_accuracy: 0.8842
Epoch 24/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1848 - accuracy: 0.9398 - val_loss: 0.2883 - val_accuracy: 0.8853
Epoch 25/40
15000/15000 [==============================] - 1s 58us/sample - loss: 0.1774 - accuracy: 0.9419 - val_loss: 0.2867 - val_accuracy: 0.8845
Epoch 26/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1700 - accuracy: 0.9463 - val_loss: 0.2862 - val_accuracy: 0.8865
Epoch 27/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.1630 - accuracy: 0.9487 - val_loss: 0.2858 - val_accuracy: 0.8857
Epoch 28/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1566 - accuracy: 0.9524 - val_loss: 0.2861 - val_accuracy: 0.8855
Epoch 29/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.1507 - accuracy: 0.9541 - val_loss: 0.2859 - val_accuracy: 0.8860
Epoch 30/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1448 - accuracy: 0.9563 - val_loss: 0.2871 - val_accuracy: 0.8849
Epoch 31/40
15000/15000 [==============================] - 1s 60us/sample - loss: 0.1394 - accuracy: 0.9583 - val_loss: 0.2871 - val_accuracy: 0.8866
Epoch 32/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.1343 - accuracy: 0.9603 - val_loss: 0.2905 - val_accuracy: 0.8836
Epoch 33/40
15000/15000 [==============================] - 1s 62us/sample - loss: 0.1301 - accuracy: 0.9619 - val_loss: 0.2901 - val_accuracy: 0.8854
Epoch 34/40
15000/15000 [==============================] - 1s 62us/sample - loss: 0.1245 - accuracy: 0.9651 - val_loss: 0.2911 - val_accuracy: 0.8843
Epoch 35/40
15000/15000 [==============================] - 1s 59us/sample - loss: 0.1200 - accuracy: 0.9662 - val_loss: 0.2931 - val_accuracy: 0.8847
Epoch 36/40
15000/15000 [==============================] - 1s 62us/sample - loss: 0.1155 - accuracy: 0.9681 - val_loss: 0.2965 - val_accuracy: 0.8841
Epoch 37/40
15000/15000 [==============================] - 1s 63us/sample - loss: 0.1119 - accuracy: 0.9692 - val_loss: 0.2972 - val_accuracy: 0.8834
Epoch 38/40
15000/15000 [==============================] - 1s 60us/sample - loss: 0.1075 - accuracy: 0.9711 - val_loss: 0.2998 - val_accuracy: 0.8830
Epoch 39/40
15000/15000 [==============================] - 1s 63us/sample - loss: 0.1040 - accuracy: 0.9715 - val_loss: 0.3024 - val_accuracy: 0.8833
Epoch 40/40
15000/15000 [==============================] - 1s 61us/sample - loss: 0.1001 - accuracy: 0.9736 - val_loss: 0.3047 - val_accuracy: 0.8829</code></pre></div></div></div></div>

<h2 id="37"><span class="pheasant-header"><span class="header"><span class="number">3.7</span> <span class="title">モデルの評価</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results = model.evaluate(test_data, test_labels, verbose=2)
print(results)</code></pre></div>
<div class="report"><p><span class="count">[11]</span>
<span class="start">2019-11-08 22:11:43</span> (<span class="time">2.02s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min52s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">25000/1 - 2s - loss: 0.3214 - accuracy: 0.8733
[0.3239115720844269, 0.87328]</code></pre></div></div></div></div>

<h2 id="38"><span class="pheasant-header"><span class="header"><span class="number">3.8</span> <span class="title">正解率と損失の時系列グラフを描く</span></span></span></h2>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">df = pd.DataFrame(history.history)
df.index.name = &#34;epoch&#34;
df.reset_index(inplace=True)
df = pd.melt(df, id_vars=[&#34;epoch&#34;], value_vars=[&#34;accuracy&#34;, &#34;val_accuracy&#34;])
chart = alt.Chart(df).mark_line(point=True).properties(width=200, height=150)
chart.encode(
    x=&#34;epoch&#34;, y=alt.Y(&#34;value&#34;, scale=alt.Scale(domain=[0.5, 1])), color=&#34;variable&#34;
)</code></pre></div>
<div class="report"><p><span class="count">[12]</span>
<span class="start">2019-11-08 22:11:45</span> (<span class="time">42.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">2min53s</span>)</span></p></div></div>

<div class="cell jupyter display"><div class="content"><div id="pheasant-altair-1"><script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-4954cc01b037ef440ed0c97a9fa50ce1"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "epoch"}, "y": {"type": "quantitative", "field": "value", "scale": {"domain": [0.5, 1]}}}, "height": 150, "width": 200, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-4954cc01b037ef440ed0c97a9fa50ce1": [{"epoch": 0, "variable": "accuracy", "value": 0.5691333413124084}, {"epoch": 1, "variable": "accuracy", "value": 0.6209333539009094}, {"epoch": 2, "variable": "accuracy", "value": 0.7475333213806152}, {"epoch": 3, "variable": "accuracy", "value": 0.7639999985694885}, {"epoch": 4, "variable": "accuracy", "value": 0.7847999930381775}, {"epoch": 5, "variable": "accuracy", "value": 0.807200014591217}, {"epoch": 6, "variable": "accuracy", "value": 0.8242666721343994}, {"epoch": 7, "variable": "accuracy", "value": 0.8410000205039978}, {"epoch": 8, "variable": "accuracy", "value": 0.8556666374206543}, {"epoch": 9, "variable": "accuracy", "value": 0.8697333335876465}, {"epoch": 10, "variable": "accuracy", "value": 0.8784666657447815}, {"epoch": 11, "variable": "accuracy", "value": 0.8868666887283325}, {"epoch": 12, "variable": "accuracy", "value": 0.8930666446685791}, {"epoch": 13, "variable": "accuracy", "value": 0.8992666602134705}, {"epoch": 14, "variable": "accuracy", "value": 0.9032666683197021}, {"epoch": 15, "variable": "accuracy", "value": 0.9080666899681091}, {"epoch": 16, "variable": "accuracy", "value": 0.9133999943733215}, {"epoch": 17, "variable": "accuracy", "value": 0.9168000221252441}, {"epoch": 18, "variable": "accuracy", "value": 0.9214000105857849}, {"epoch": 19, "variable": "accuracy", "value": 0.9257333278656006}, {"epoch": 20, "variable": "accuracy", "value": 0.9286666512489319}, {"epoch": 21, "variable": "accuracy", "value": 0.9319333434104919}, {"epoch": 22, "variable": "accuracy", "value": 0.9345333576202393}, {"epoch": 23, "variable": "accuracy", "value": 0.9398000240325928}, {"epoch": 24, "variable": "accuracy", "value": 0.9419333338737488}, {"epoch": 25, "variable": "accuracy", "value": 0.9462666511535645}, {"epoch": 26, "variable": "accuracy", "value": 0.9487333297729492}, {"epoch": 27, "variable": "accuracy", "value": 0.9524000287055969}, {"epoch": 28, "variable": "accuracy", "value": 0.9541333317756653}, {"epoch": 29, "variable": "accuracy", "value": 0.9562666416168213}, {"epoch": 30, "variable": "accuracy", "value": 0.9583333134651184}, {"epoch": 31, "variable": "accuracy", "value": 0.960266649723053}, {"epoch": 32, "variable": "accuracy", "value": 0.9618666768074036}, {"epoch": 33, "variable": "accuracy", "value": 0.9651333093643188}, {"epoch": 34, "variable": "accuracy", "value": 0.9661999940872192}, {"epoch": 35, "variable": "accuracy", "value": 0.9681333303451538}, {"epoch": 36, "variable": "accuracy", "value": 0.9692000150680542}, {"epoch": 37, "variable": "accuracy", "value": 0.9711333513259888}, {"epoch": 38, "variable": "accuracy", "value": 0.9715333580970764}, {"epoch": 39, "variable": "accuracy", "value": 0.9735999703407288}, {"epoch": 0, "variable": "val_accuracy", "value": 0.5382000207901001}, {"epoch": 1, "variable": "val_accuracy", "value": 0.739300012588501}, {"epoch": 2, "variable": "val_accuracy", "value": 0.7376000285148621}, {"epoch": 3, "variable": "val_accuracy", "value": 0.7602999806404114}, {"epoch": 4, "variable": "val_accuracy", "value": 0.777999997138977}, {"epoch": 5, "variable": "val_accuracy", "value": 0.7997999787330627}, {"epoch": 6, "variable": "val_accuracy", "value": 0.8133999705314636}, {"epoch": 7, "variable": "val_accuracy", "value": 0.8295999765396118}, {"epoch": 8, "variable": "val_accuracy", "value": 0.8396999835968018}, {"epoch": 9, "variable": "val_accuracy", "value": 0.8482000231742859}, {"epoch": 10, "variable": "val_accuracy", "value": 0.8547999858856201}, {"epoch": 11, "variable": "val_accuracy", "value": 0.8611000180244446}, {"epoch": 12, "variable": "val_accuracy", "value": 0.864300012588501}, {"epoch": 13, "variable": "val_accuracy", "value": 0.8691999912261963}, {"epoch": 14, "variable": "val_accuracy", "value": 0.871999979019165}, {"epoch": 15, "variable": "val_accuracy", "value": 0.8748999834060669}, {"epoch": 16, "variable": "val_accuracy", "value": 0.8776000142097473}, {"epoch": 17, "variable": "val_accuracy", "value": 0.8801000118255615}, {"epoch": 18, "variable": "val_accuracy", "value": 0.8823999762535095}, {"epoch": 19, "variable": "val_accuracy", "value": 0.8809000253677368}, {"epoch": 20, "variable": "val_accuracy", "value": 0.8833000063896179}, {"epoch": 21, "variable": "val_accuracy", "value": 0.8830000162124634}, {"epoch": 22, "variable": "val_accuracy", "value": 0.8841999769210815}, {"epoch": 23, "variable": "val_accuracy", "value": 0.8852999806404114}, {"epoch": 24, "variable": "val_accuracy", "value": 0.8845000267028809}, {"epoch": 25, "variable": "val_accuracy", "value": 0.8865000009536743}, {"epoch": 26, "variable": "val_accuracy", "value": 0.885699987411499}, {"epoch": 27, "variable": "val_accuracy", "value": 0.8855000138282776}, {"epoch": 28, "variable": "val_accuracy", "value": 0.8859999775886536}, {"epoch": 29, "variable": "val_accuracy", "value": 0.8848999738693237}, {"epoch": 30, "variable": "val_accuracy", "value": 0.8866000175476074}, {"epoch": 31, "variable": "val_accuracy", "value": 0.8835999965667725}, {"epoch": 32, "variable": "val_accuracy", "value": 0.8853999972343445}, {"epoch": 33, "variable": "val_accuracy", "value": 0.8842999935150146}, {"epoch": 34, "variable": "val_accuracy", "value": 0.8847000002861023}, {"epoch": 35, "variable": "val_accuracy", "value": 0.8841000199317932}, {"epoch": 36, "variable": "val_accuracy", "value": 0.883400022983551}, {"epoch": 37, "variable": "val_accuracy", "value": 0.8830000162124634}, {"epoch": 38, "variable": "val_accuracy", "value": 0.8833000063896179}, {"epoch": 39, "variable": "val_accuracy", "value": 0.8828999996185303}]}};
    var opt = {
      "mode": "vega-lite",
      "renderer": "canvas",
      "actions": {"editor": true, "source": true, "export": true}
    };
    vegaEmbed("#pheasant-altair-1", spec, opt).catch(console.err);
  });</script></div></div></div></div></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../TF.Hubによるテキスト分類/" title="2 TF.Hubによるテキスト分類"><span>Previous</span></a></div>
        <div class="next"><a href="../回帰：燃費を予測する/" title="4 回帰：燃費を予測する"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>
        var base_url = '.';
    </script>
    <script src="../../../../../js/theme.js"></script>
    <script src="../../../../../js/pheasant.js"></script>
</body>

</html>